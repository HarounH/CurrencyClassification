#include <SPI.h>
#include <SD.h>
#include <String.h>
#include <math.h>
#include <avr/pgmspace.h>
#include <SoftwareSerial.h>

#define FLASH 1
/* SD card attached to SPI bus as follows:
 ** MOSI - pin 11
 ** MISO - pin 12
 ** CLK - pin 13
 ** CS - pin 4
*/

const char datasetName[20] = "usps2.txt";

#if FLASH
 
  const int M PROGMEM =4;
  const int D PROGMEM =257;
  const int model[4369] PROGMEM ={13,-8,5,3,0,4,-1,-0,-0,0,-1,-0,-0,0,-106,-13,15,-25,-19,-36,4,-0,-41,4,0,-5,-0,-1,-0,-2,0,-303,-46,51,-109,8,-87,11,-6,-89,14,1,-5,-1,6,0,-3,0,-549,-78,71,14,-103,-62,69,5,-69,13,2,-9,-2,0,0,-1,-0,-622,-115,27,23,-118,-69,18,17,-70,15,6,-13,-3,-3,0,-10,-0,-1014,-162,42,-26,22,-40,-52,32,-46,8,4,-10,-3,7,1,-13,-0,-1132,-208,171,56,-79,-70,93,34,-91,14,0,1,-2,6,0,-2,0,-703,-71,390,-20,-45,-41,49,11,-112,10,-5,0,-5,8,1,6,3,-323,158,673,-82,-85,-80,-46,-5,-119,18,-12,-2,-7,14,2,11,2,667,340,737,-38,-159,-34,-45,-27,-179,10,-4,-3,-6,8,1,11,1,979,302,651,8,-94,-8,-25,-29,-57,1,-2,1,-2,-23,0,3,1,996,175,567,-54,-4,-3,-67,-16,-17,-3,-3,2,-2,-20,-1,-8,0,582,34,350,-140,142,36,-72,-21,36,-3,-0,-1,-1,-13,-2,-11,0,88,-33,147,-93,43,6,-9,-17,26,5,-2,-1,-1,-4,-1,-4,0,-76,-46,18,-41,25,2,-6,-8,10,1,-3,-2,-0,-2,-2,-4,0,23,-14,-29,-12,-5,-16,3,-0,-18,-0,-0,-4,0,-1,-0,-2,0,16,-2,-13,1,-4,0,-0,-1,1,0,-0,-0,-0,-1,-0,0,0,-179,-19,28,-43,-25,-67,19,-4,-59,10,0,-7,-2,1,-1,-1,0,-862,-97,71,-30,30,-17,35,-1,-22,12,-0,-4,-5,13,-0,4,-0,-1012,-155,103,-23,-15,-69,53,11,-53,12,0,-10,-5,9,-0,-2,-0,-1181,-195,135,122,-79,-27,141,34,-46,1,1,-17,-2,12,-1,-4,0,-1978,-268,295,-16,42,-53,43,33,-39,12,2,6,1,23,-1,-30,1,-1150,-154,602,-74,19,-45,-40,22,-86,20,5,16,-3,14,-0,-5,2,-483,34,857,64,-164,-19,54,31,-169,7,2,-5,-8,11,-2,-12,5,-297,154,900,-69,-164,-102,22,4,-194,15,-8,-7,-10,30,-1,11,4,395,270,826,-80,-78,12,-34,-27,-93,-2,-5,6,-11,-8,4,0,2,811,408,817,-27,-74,-15,40,-18,-52,-2,-6,5,-5,-20,3,-1,3,1371,353,788,58,-63,-4,83,-2,-19,-10,-5,0,-2,-20,-3,4,1,821,119,723,-60,-2,2,-6,-8,1,-7,-1,-4,-3,-12,-4,-13,1,29,-23,429,37,-47,64,53,-2,29,-11,1,-3,-2,-13,-5,-13,0,94,-26,219,-115,-6,-32,-84,-16,-35,5,-2,-4,0,0,-3,-7,0,-1,-27,2,-29,-4,-24,-13,-4,-25,2,-0,-7,0,-0,-1,-2,0,-15,-8,-12,-121,64,-50,-16,-16,-20,10,0,4,-0,-3,0,3,-0,-137,-6,8,-86,47,-41,7,-11,-17,14,-2,3,-1,4,-1,-1,0,-584,-83,8,10,-4,-39,31,9,-38,8,-4,2,-3,14,-0,0,-0,-1186,-180,137,-66,71,-88,23,19,6,5,-5,-9,-3,11,-0,0,0,-2089,-263,225,15,-18,-55,58,23,-2,0,-3,4,-1,9,-2,-10,2,-1830,-181,508,-73,64,14,-29,-8,5,-1,0,0,-0,-3,-0,-5,2,-104,6,701,3,-73,33,68,-15,-3,5,4,-1,-2,-7,-1,-14,3,497,160,719,-9,-63,25,17,-15,-66,-9,5,4,-4,-4,-3,-17,5,431,329,640,-45,-86,5,-3,-7,-81,3,-5,10,-5,14,-1,14,3,-7,246,555,20,-45,75,-36,-12,46,-6,-4,17,-9,-9,-0,1,2,298,190,600,26,-40,-25,20,-5,14,2,-4,-1,-5,-2,-2,-14,3,872,187,704,-63,96,-26,-75,-6,16,-8,-6,-3,-2,-1,-6,19,2,601,143,876,40,-19,43,-25,4,40,-10,1,3,-0,-2,-5,10,1,-248,27,580,31,-50,23,42,-0,15,-6,3,-5,0,-13,-4,-10,1,-223,8,410,-31,-49,6,-80,-5,-32,-1,1,-10,1,3,-4,-10,0,51,-15,148,-41,-3,-24,-35,-5,-27,3,0,-10,1,1,-1,-8,0,-79,-25,-16,-125,41,-68,4,-12,-43,11,-0,2,0,-4,-0,-1,0,-47,-10,-8,16,33,31,58,-0,48,2,-4,5,-0,0,-3,-11,0,-264,-60,15,-35,21,-38,50,4,-42,4,-6,-2,-4,30,2,-7,0,-1473,-142,105,-56,35,-23,65,14,-12,-3,-2,-7,-2,8,2,8,2,-2180,-182,304,-4,-37,-14,65,9,2,-8,0,3,1,-21,1,-7,3,-1021,-64,498,-98,10,-42,71,-25,-63,0,-7,-13,3,-11,4,-21,2,542,131,580,-80,-0,-16,72,-42,-42,1,1,-5,1,-32,-4,-32,2,1803,398,598,-63,-64,0,-44,-39,0,-11,5,11,-3,-55,-6,-6,4,930,362,563,18,-189,-20,52,-16,-49,-1,1,5,-0,3,2,13,4,-859,103,408,-1,-139,-43,-21,17,-77,5,-3,-4,-4,38,0,-1,2,-653,-128,479,27,-67,-97,21,7,-14,18,-6,-19,-6,20,-6,-4,2,448,-100,745,98,-69,0,80,-1,41,1,-1,-20,-4,-1,-8,7,1,-163,-17,773,56,-50,-17,23,3,-15,0,2,-7,-1,-8,-5,13,1,-867,-30,549,4,-45,12,1,-6,25,4,4,-16,0,-12,-2,6,1,-919,-18,404,-9,-40,-10,-23,-2,-38,3,0,-12,3,3,-5,-1,0,-145,-13,159,-99,37,-49,-29,-10,-42,8,1,-8,1,-0,-3,-1,0,-88,-33,-23,-114,21,-78,30,-13,-47,11,-0,0,-0,-11,-2,-4,0,-177,-23,-24,-2,19,14,74,-3,36,1,-2,5,-2,0,-4,-13,1,-346,-45,24,-37,16,3,40,8,9,-0,-2,-7,-4,15,4,-11,2,-1368,-70,98,-83,21,-35,30,15,-34,-6,-1,-4,-1,4,7,2,2,-1491,-17,319,-29,-17,-52,133,-8,7,-7,1,11,1,-15,2,-13,3,-343,65,446,-29,10,-27,97,-35,28,0,-6,-14,6,-18,0,-32,3,1246,251,489,-48,-5,-22,48,-52,-0,-2,-3,-12,-1,-20,-5,-23,2,1834,392,425,-40,81,108,-13,-69,178,-26,2,8,-8,-45,-4,-24,4,-632,226,414,-10,-83,54,-166,-37,-11,-11,4,-1,-9,-19,-3,10,4,-2538,-164,274,70,-142,4,-111,27,-74,-1,-2,-19,-11,31,-7,6,2,-2000,-520,387,80,-111,-47,-38,13,-26,13,-4,-27,-8,19,-15,3,2,-157,-430,700,39,-141,-54,14,1,-67,11,-0,-36,-6,13,-8,-10,1,-803,-214,663,39,-131,-63,66,12,-70,8,4,-18,-1,21,-3,3,1,-1317,-97,376,-35,-71,-41,66,-4,-17,11,5,-17,-0,16,2,0,1,-1389,-49,247,8,-115,-98,85,0,-106,9,1,-8,2,-5,-4,-4,1,-257,43,110,-13,-77,-52,7,1,-72,5,0,-3,0,-2,-2,-1,0,30,-1,-0,-100,71,-67,-2,-10,-43,6,-0,5,-2,-5,-4,1,0,-378,-28,-24,-98,12,-57,13,-17,-34,7,-5,5,-3,5,-4,-9,1,-385,-10,21,29,10,48,38,5,61,-1,3,-4,-4,39,3,-6,2,-808,32,153,-170,20,-70,64,-9,35,6,-1,-18,-2,30,10,-19,2,-913,67,277,-167,186,7,-60,-43,138,0,-7,-0,-1,6,6,-21,2,-139,142,434,-26,70,-73,9,-46,26,8,-6,5,6,-5,-6,-13,3,1114,295,515,18,41,-9,109,-42,19,-1,-0,1,-2,-0,-8,-35,2,561,252,491,-65,183,95,40,-51,154,-22,1,13,-7,-25,-1,-19,4,-2205,-22,501,47,18,126,-18,-20,37,-19,0,7,-8,-13,-3,-0,3,-3979,-391,434,30,-81,-9,-13,5,-48,-2,-7,3,-8,25,-8,-10,2,-3115,-739,487,81,-46,-12,12,13,-15,1,-4,-2,-4,39,-7,-18,3,-617,-666,595,79,-138,-30,96,12,-26,7,2,-15,-0,3,-3,-13,1,-305,-316,460,91,-130,-39,108,36,-43,9,8,-16,-2,13,1,-17,1,-667,-72,354,155,-147,-11,103,34,-22,7,5,-11,-1,15,1,-14,0,-569,19,267,95,-139,-49,80,8,-61,7,0,-7,0,-4,-1,-12,0,85,85,108,-29,-97,-83,49,-3,-91,8,-0,-1,1,2,-0,-5,0,64,36,18,-132,57,-45,-26,-21,4,7,-0,3,-2,1,-2,0,1,-395,-4,15,9,-39,4,10,-12,27,-0,-0,1,0,10,-4,-5,2,19,66,92,-49,87,24,-99,-8,61,0,1,-4,-1,35,4,-11,2,-304,127,207,48,-19,29,36,10,93,-4,-0,-24,0,18,13,-31,2,6,181,262,51,78,21,-94,0,110,-16,-4,-5,3,7,8,-19,1,651,217,426,13,150,25,20,-19,47,-14,-1,1,3,19,-3,1,1,188,212,481,-22,72,4,5,-8,16,-22,-2,5,4,11,-2,-10,0,-1085,57,620,8,49,28,28,-10,40,-20,-2,1,-6,13,-0,-13,4,-3935,-223,786,-15,125,98,0,-7,20,-15,-3,7,-12,35,-3,-7,3,-5129,-497,699,4,74,34,-39,25,39,-12,-7,13,-11,42,-6,-23,3,-3417,-796,654,26,-2,-15,-52,34,-31,-7,-5,7,-5,23,-4,-5,3,-554,-692,651,-16,26,15,42,26,33,-0,1,2,-3,-0,2,-6,1,-25,-352,380,63,-53,-13,35,35,-11,2,4,-3,-1,-0,4,-23,1,191,-0,364,-28,20,-48,24,25,-43,6,2,-4,-0,8,2,-9,1,299,114,276,-6,-43,-79,37,7,-67,3,-0,-10,-1,-17,-2,-7,1,375,130,192,-22,-12,-28,39,-4,-21,-0,0,0,4,-1,-0,-2,0,151,80,81,-64,30,-23,-27,-8,10,1,0,3,2,2,-0,2,1,49,80,99,3,30,20,-44,-5,55,-8,0,2,8,-18,-2,-3,1,629,197,214,53,-29,37,26,1,68,-22,-2,-0,5,-9,4,-9,-1,917,259,216,3,-15,-0,116,12,51,-30,-2,-21,8,-16,10,-10,-3,1014,273,124,-32,4,-26,80,-4,4,-38,-4,-24,12,-6,6,-11,-3,783,199,207,-2,-3,-7,39,11,-52,-45,-4,-16,10,8,-1,7,-3,-497,-42,254,66,-67,-1,143,28,11,-50,-1,-4,4,2,-0,8,-4,-2648,-261,428,-10,85,81,8,18,27,-61,0,9,-6,12,1,12,-2,-4725,-373,528,-28,78,74,-28,20,-25,-61,0,20,-9,22,-2,20,-2,-4552,-516,515,31,-102,34,2,57,-18,-53,-3,8,-7,41,-2,19,-3,-2367,-728,546,-28,-58,-21,30,60,-23,-34,1,-0,-6,23,2,0,-1,125,-578,531,39,43,94,-36,36,91,-40,3,11,0,-11,2,-19,-1,1002,-193,450,-66,25,-21,-35,19,-14,-17,-1,-3,7,-12,0,-8,-1,1439,173,301,16,-31,48,-0,13,53,-20,-1,0,4,1,1,6,-3,1253,265,182,-4,-36,49,-8,-3,82,-19,-2,-1,1,-16,1,2,-2,888,209,129,-5,-9,-2,17,0,4,-14,-0,-2,5,-17,0,3,-1,316,112,99,48,-28,-12,20,0,13,-2,0,-5,5,-9,0,5,-0,516,137,169,3,-63,-49,17,-6,14,-12,0,-7,11,-15,4,2,-3,876,258,246,1,-35,-36,73,19,-4,-28,-2,1,13,-22,3,-4,-4,1458,355,212,11,-49,-64,125,27,-35,-29,-0,4,12,-24,1,11,-4,1571,297,106,-4,-16,-12,45,5,-47,-37,-1,-4,9,-13,0,-10,-2,512,85,122,-10,49,60,-5,12,1,-40,-1,-9,5,4,0,12,-2,-1152,-244,48,36,-3,55,108,27,76,-48,1,-3,-1,18,0,8,-2,-3371,-482,223,-76,74,25,-0,9,18,-55,2,4,-4,30,-2,-9,-0,-4345,-536,355,-92,171,99,-147,8,74,-61,1,1,-1,1,-4,-1,-1,-3803,-601,374,15,-17,43,-37,62,64,-60,-2,-4,1,2,-6,7,-1,-1985,-733,507,22,48,28,-6,74,87,-49,2,-2,-0,-18,-3,-11,-2,658,-452,660,11,-2,41,8,28,65,-40,3,-1,9,-24,1,0,-4,1618,56,617,30,-8,40,-17,26,38,-29,-1,-12,14,-39,-1,8,-3,2216,338,533,82,6,76,13,28,84,-23,-2,-5,6,-25,-0,16,-2,1854,435,439,41,63,102,3,-12,156,-9,-0,-7,2,-2,1,4,-0,966,310,305,-14,91,36,-69,-6,40,-5,-1,0,1,-8,3,4,0,447,125,155,44,-9,-10,-12,-14,8,2,-1,-3,2,-22,1,2,0,397,108,155,137,-44,-2,71,0,58,-0,1,-7,6,-13,4,-7,0,790,271,423,-19,36,-48,46,12,66,0,3,-0,10,-6,0,-12,0,1127,433,558,86,-40,-64,89,50,-7,-6,1,10,7,-3,-2,-13,-0,1285,314,420,62,5,-22,44,32,29,5,0,11,5,-13,-3,-18,0,455,39,177,-1,5,-60,53,39,-7,1,1,2,-0,-14,-1,-3,-0,-885,-296,-60,-4,62,2,-14,37,66,-19,2,-12,-4,7,-2,-17,0,-2507,-429,221,0,82,53,-24,2,54,-33,4,-7,-3,29,-1,-25,2,-3311,-467,394,-76,102,45,-133,3,36,-30,0,-4,-1,6,-5,-7,2,-2812,-612,496,-7,53,33,26,45,91,-24,-2,-15,-0,3,-8,-2,1,-1514,-765,616,-27,21,-58,-57,47,33,-11,-3,-15,1,-20,-8,-28,0,848,-383,567,74,-88,-30,63,27,0,-14,-0,-12,8,-14,-6,-3,0,1706,133,667,-60,57,-54,-21,10,-14,-1,2,-18,8,-29,-4,-0,1,2215,483,886,-14,41,-25,-16,9,9,-5,1,-12,4,-40,-1,11,0,1510,538,733,-72,96,-6,12,-18,55,-1,-3,-7,2,-12,4,5,0,617,363,466,-37,60,9,-68,-10,15,-5,-1,1,-1,-1,2,2,0,95,72,159,-0,21,-8,-25,-10,7,-1,-1,-1,1,0,2,-4,0,-110,5,132,32,75,3,1,2,42,-10,-0,6,4,-17,1,-4,1,408,220,415,-118,118,-61,19,-7,95,12,0,0,9,-33,1,-3,0,845,493,649,-30,-4,-80,51,27,37,14,-3,6,3,-2,3,-21,-0,1040,403,543,-29,-15,-88,84,30,49,26,-5,9,-3,-1,5,-28,-0,738,134,201,136,-92,53,71,46,84,9,-5,3,-10,-3,-0,-10,1,114,-97,53,20,-30,1,73,21,59,-3,-4,-3,-12,13,1,-18,2,-1126,-197,260,-60,129,53,-72,-7,73,-13,-2,9,-11,-3,3,-11,4,-2163,-334,442,-70,81,41,-109,2,64,-10,-3,-11,-10,-1,-5,-25,4,-2825,-687,579,-66,69,-12,2,18,54,3,-8,-21,-8,-9,-13,-28,4,-1159,-737,515,-45,83,-35,15,13,45,8,-8,-11,-5,-18,-11,-15,2,1475,-298,361,19,18,-13,24,17,27,-6,-4,-16,4,-12,-4,17,1,2345,200,457,-18,75,36,-57,6,89,-9,3,3,6,-23,-0,7,0,2661,625,830,-4,96,63,-103,4,50,-12,3,5,3,-33,-0,25,0,1841,645,867,-9,68,33,-7,-12,68,-3,-3,3,0,-3,4,16,-0,629,355,479,59,-17,26,41,-0,37,-4,-1,-4,-2,2,1,4,-0,22,43,141,17,24,19,1,11,29,-10,-2,-9,2,22,1,-7,0,-379,-49,183,114,-56,4,46,13,-11,-12,-3,-3,3,-4,-0,-4,0,-12,101,372,88,3,23,95,18,65,-5,-3,12,6,-43,-0,-12,0,728,411,478,7,34,-15,50,30,86,5,-2,16,1,-22,4,-8,-0,1512,515,506,-1,44,-37,84,25,86,14,-3,22,-0,-16,5,-12,0,1634,378,355,-43,9,-78,94,13,13,19,-4,10,-5,9,0,-16,0,1323,123,285,75,-15,25,-24,13,37,-4,-2,6,-7,1,-2,3,1,375,-19,418,34,18,45,-102,-2,35,-10,-1,0,-6,-5,-1,-20,4,-1404,-314,466,58,-73,11,-36,2,13,0,-2,-24,-4,16,-5,-31,3,-3083,-772,576,32,19,18,-34,4,91,3,-9,-18,-5,-26,-12,11,3,-422,-700,213,-10,119,11,-13,-7,-28,0,-9,8,-5,-26,-9,29,2,2814,-115,-38,12,75,22,-17,-14,43,-3,-6,12,2,-12,-1,38,2,3388,420,256,53,-18,54,-54,-4,62,-12,3,20,2,4,1,16,0,3315,759,755,-30,29,33,-22,-22,27,-5,2,4,1,-31,0,11,0,1973,672,758,34,-11,32,-22,-8,24,-5,-2,-1,-1,-5,1,9,-0,623,319,461,-13,30,6,11,-4,22,-0,-1,-0,-0,4,1,0,-0,-6,65,175,-18,67,37,-30,7,42,-8,-1,-4,4,-4,1,-5,0,-260,-32,131,6,24,7,37,12,-6,-9,-5,7,1,3,-0,-8,0,-219,32,263,117,-49,39,109,18,31,-10,-3,18,-0,-38,1,-5,0,319,260,395,89,-46,-8,10,29,-10,-2,1,19,-3,5,6,7,0,1345,560,470,23,-35,-114,56,16,-32,19,-4,33,-0,-15,6,6,0,2488,667,577,-1,6,-97,55,-7,4,16,-1,20,-1,-30,-2,4,0,2622,452,525,23,23,-51,1,-0,-4,5,0,14,-1,-4,-3,6,2,1196,99,604,80,16,90,-88,-23,-1,-6,1,5,-4,1,-2,0,3,-608,-174,636,0,3,11,-66,-13,-41,0,1,-10,-3,-2,-4,2,3,-1763,-523,649,23,-41,-64,23,-1,-38,12,-8,0,-1,-17,-3,27,2,1239,-364,297,-81,14,-29,-86,-27,-112,16,-13,17,-4,-14,-2,38,1,3821,169,108,-16,-52,-9,-68,-23,-35,-2,-9,11,0,6,0,14,1,3486,614,461,12,-17,29,35,-13,68,-7,-1,17,0,4,-0,23,0,2902,781,833,-3,11,33,-13,-14,26,-8,-0,7,0,-24,-0,22,-0,1547,606,735,-34,59,24,-70,-16,12,-2,-3,5,-0,-22,-0,4,-0,526,264,390,-79,70,-8,-37,-10,17,4,-2,0,0,-10,-0,0,-0,-3,54,156,42,2,41,-12,5,10,-8,-2,2,1,-7,-0,-3,0,-5,-12,28,74,-9,49,20,10,12,-10,-4,5,4,-1,-0,0,0,-139,-8,159,129,-29,83,38,29,29,-15,-3,17,-1,24,-0,4,0,-246,60,232,43,4,40,-36,33,-28,-7,1,16,-6,24,6,13,-0,1119,473,495,-9,24,-32,-53,10,-89,10,-3,25,-3,1,5,8,1,2395,783,719,48,58,30,-56,0,-18,10,-2,28,-3,-15,-1,13,1,2866,728,805,-82,18,-84,-108,-19,-45,12,2,24,-4,-0,-4,22,2,2056,430,935,12,-16,73,-108,-38,31,-3,6,17,-2,-5,-4,53,4,1020,212,1068,12,20,23,-82,-29,72,-7,3,11,-1,-15,-5,2,4,621,102,1091,85,-39,-24,-52,-7,-55,1,-5,21,-2,-3,-3,9,2,2527,297,921,-40,51,65,-134,-10,13,-1,-5,19,-0,-1,-0,27,2,3467,613,698,-106,11,5,-12,-11,24,-2,-4,16,0,0,-3,22,1,2789,709,823,-42,62,13,-71,-0,28,-8,0,22,1,-11,-5,36,0,2407,691,911,48,11,66,-59,1,14,-12,-2,14,-0,-6,-5,24,0,1251,427,639,-43,66,10,-1,0,21,-3,-3,9,0,-19,-1,2,-0,447,154,302,26,-16,6,-2,5,9,-1,-1,1,0,-8,-1,0,-0,58,10,85,65,-34,29,13,10,-8,-8,-1,2,0,-1,0,-0,0,-5,-14,-26,104,-37,65,-20,16,-0,-13,-2,5,0,1,0,4,0,-49,-26,29,112,-28,78,4,22,-8,-14,-3,10,0,30,1,15,0,-132,-8,134,72,27,101,-42,20,-15,-16,-3,10,-3,29,5,24,0,35,165,265,-0,67,23,-116,14,-84,-11,-7,17,-7,25,5,27,0,1029,583,673,55,-21,-31,8,6,-141,0,-3,20,-2,5,-0,14,2,1979,786,1009,63,-54,-47,85,-9,-76,10,5,24,-2,4,1,12,2,2200,727,1214,-114,3,-122,24,-38,-75,7,2,18,2,-16,0,57,5,1359,570,1345,-48,61,-32,-3,-24,42,-5,1,17,2,-22,-1,8,5,1122,525,1486,-41,90,-0,-22,-14,19,-4,-2,19,0,-24,0,1,3,2439,677,1300,-82,15,-13,5,2,-46,-3,-9,17,1,-8,0,20,2,2534,665,970,-39,56,51,-80,9,72,-7,-3,9,1,-13,-5,27,1,2188,567,844,24,67,58,-117,12,37,-15,0,14,1,0,-9,29,1,1782,457,705,49,12,50,-42,10,36,-8,-2,15,-0,-1,-3,17,0,1001,245,422,65,-24,21,14,10,24,-5,-4,6,-0,-16,-1,1,-0,371,66,158,51,-26,15,6,6,8,-3,-2,1,-0,-4,-0,-1,-0,118,5,22,11,-6,5,3,2,-2,-1,-0,0,0,-1,-0,0,0,10,-2,-7,12,5,19,-5,3,0,-2,-1,0,-0,-7,-0,3,0,3,-15,-11,-32,68,35,-39,2,13,-3,-2,6,-1,-1,1,11,0,79,-2,22,68,8,73,-30,12,-11,-9,-3,11,-0,12,1,17,0,80,12,101,19,49,49,-49,11,-53,-8,-4,17,-4,16,4,32,0,66,109,231,-9,122,63,-89,-3,3,-12,0,16,-4,5,1,35,1,623,356,508,28,-11,-31,-41,-11,-22,2,5,19,-1,-10,-2,-9,0,1196,519,821,-15,12,-45,-45,-23,-15,6,-2,9,2,-14,-5,-9,3,850,453,1075,-49,-12,-71,-46,-12,-2,6,2,13,2,-8,-3,2,4,907,369,1064,-35,-10,-26,-27,-2,-43,2,-2,2,0,-6,0,18,2,1328,357,883,25,-14,56,25,5,34,-3,-2,-0,0,-21,-2,24,1,1362,330,610,-23,102,73,-88,6,98,-3,-0,6,0,-26,-4,27,0,1253,260,424,142,2,97,-36,27,70,-16,-0,19,0,-22,-6,20,0,1141,152,260,104,-17,74,11,14,59,-10,-0,8,0,-16,-2,3,0,587,69,121,25,-9,14,14,1,17,-1,-0,1,0,-10,-0,0,-0,203,30,39,14,-1,12,1,0,10,-0,-0,0,0,-0,-0,0,-0,32,3,2,53,22,70,-108,13,23,-39,-3,-16,-1,-25,-5,3,0,-144,-60,788};
 
#else
  
  const int M  =4;
  const int D  =257;
  const int model[4369]  ={13,-8,5,3,0,4,-1,-0,-0,0,-1,-0,-0,0,-106,-13,15,-25,-19,-36,4,-0,-41,4,0,-5,-0,-1,-0,-2,0,-303,-46,51,-109,8,-87,11,-6,-89,14,1,-5,-1,6,0,-3,0,-549,-78,71,14,-103,-62,69,5,-69,13,2,-9,-2,0,0,-1,-0,-622,-115,27,23,-118,-69,18,17,-70,15,6,-13,-3,-3,0,-10,-0,-1014,-162,42,-26,22,-40,-52,32,-46,8,4,-10,-3,7,1,-13,-0,-1132,-208,171,56,-79,-70,93,34,-91,14,0,1,-2,6,0,-2,0,-703,-71,390,-20,-45,-41,49,11,-112,10,-5,0,-5,8,1,6,3,-323,158,673,-82,-85,-80,-46,-5,-119,18,-12,-2,-7,14,2,11,2,667,340,737,-38,-159,-34,-45,-27,-179,10,-4,-3,-6,8,1,11,1,979,302,651,8,-94,-8,-25,-29,-57,1,-2,1,-2,-23,0,3,1,996,175,567,-54,-4,-3,-67,-16,-17,-3,-3,2,-2,-20,-1,-8,0,582,34,350,-140,142,36,-72,-21,36,-3,-0,-1,-1,-13,-2,-11,0,88,-33,147,-93,43,6,-9,-17,26,5,-2,-1,-1,-4,-1,-4,0,-76,-46,18,-41,25,2,-6,-8,10,1,-3,-2,-0,-2,-2,-4,0,23,-14,-29,-12,-5,-16,3,-0,-18,-0,-0,-4,0,-1,-0,-2,0,16,-2,-13,1,-4,0,-0,-1,1,0,-0,-0,-0,-1,-0,0,0,-179,-19,28,-43,-25,-67,19,-4,-59,10,0,-7,-2,1,-1,-1,0,-862,-97,71,-30,30,-17,35,-1,-22,12,-0,-4,-5,13,-0,4,-0,-1012,-155,103,-23,-15,-69,53,11,-53,12,0,-10,-5,9,-0,-2,-0,-1181,-195,135,122,-79,-27,141,34,-46,1,1,-17,-2,12,-1,-4,0,-1978,-268,295,-16,42,-53,43,33,-39,12,2,6,1,23,-1,-30,1,-1150,-154,602,-74,19,-45,-40,22,-86,20,5,16,-3,14,-0,-5,2,-483,34,857,64,-164,-19,54,31,-169,7,2,-5,-8,11,-2,-12,5,-297,154,900,-69,-164,-102,22,4,-194,15,-8,-7,-10,30,-1,11,4,395,270,826,-80,-78,12,-34,-27,-93,-2,-5,6,-11,-8,4,0,2,811,408,817,-27,-74,-15,40,-18,-52,-2,-6,5,-5,-20,3,-1,3,1371,353,788,58,-63,-4,83,-2,-19,-10,-5,0,-2,-20,-3,4,1,821,119,723,-60,-2,2,-6,-8,1,-7,-1,-4,-3,-12,-4,-13,1,29,-23,429,37,-47,64,53,-2,29,-11,1,-3,-2,-13,-5,-13,0,94,-26,219,-115,-6,-32,-84,-16,-35,5,-2,-4,0,0,-3,-7,0,-1,-27,2,-29,-4,-24,-13,-4,-25,2,-0,-7,0,-0,-1,-2,0,-15,-8,-12,-121,64,-50,-16,-16,-20,10,0,4,-0,-3,0,3,-0,-137,-6,8,-86,47,-41,7,-11,-17,14,-2,3,-1,4,-1,-1,0,-584,-83,8,10,-4,-39,31,9,-38,8,-4,2,-3,14,-0,0,-0,-1186,-180,137,-66,71,-88,23,19,6,5,-5,-9,-3,11,-0,0,0,-2089,-263,225,15,-18,-55,58,23,-2,0,-3,4,-1,9,-2,-10,2,-1830,-181,508,-73,64,14,-29,-8,5,-1,0,0,-0,-3,-0,-5,2,-104,6,701,3,-73,33,68,-15,-3,5,4,-1,-2,-7,-1,-14,3,497,160,719,-9,-63,25,17,-15,-66,-9,5,4,-4,-4,-3,-17,5,431,329,640,-45,-86,5,-3,-7,-81,3,-5,10,-5,14,-1,14,3,-7,246,555,20,-45,75,-36,-12,46,-6,-4,17,-9,-9,-0,1,2,298,190,600,26,-40,-25,20,-5,14,2,-4,-1,-5,-2,-2,-14,3,872,187,704,-63,96,-26,-75,-6,16,-8,-6,-3,-2,-1,-6,19,2,601,143,876,40,-19,43,-25,4,40,-10,1,3,-0,-2,-5,10,1,-248,27,580,31,-50,23,42,-0,15,-6,3,-5,0,-13,-4,-10,1,-223,8,410,-31,-49,6,-80,-5,-32,-1,1,-10,1,3,-4,-10,0,51,-15,148,-41,-3,-24,-35,-5,-27,3,0,-10,1,1,-1,-8,0,-79,-25,-16,-125,41,-68,4,-12,-43,11,-0,2,0,-4,-0,-1,0,-47,-10,-8,16,33,31,58,-0,48,2,-4,5,-0,0,-3,-11,0,-264,-60,15,-35,21,-38,50,4,-42,4,-6,-2,-4,30,2,-7,0,-1473,-142,105,-56,35,-23,65,14,-12,-3,-2,-7,-2,8,2,8,2,-2180,-182,304,-4,-37,-14,65,9,2,-8,0,3,1,-21,1,-7,3,-1021,-64,498,-98,10,-42,71,-25,-63,0,-7,-13,3,-11,4,-21,2,542,131,580,-80,-0,-16,72,-42,-42,1,1,-5,1,-32,-4,-32,2,1803,398,598,-63,-64,0,-44,-39,0,-11,5,11,-3,-55,-6,-6,4,930,362,563,18,-189,-20,52,-16,-49,-1,1,5,-0,3,2,13,4,-859,103,408,-1,-139,-43,-21,17,-77,5,-3,-4,-4,38,0,-1,2,-653,-128,479,27,-67,-97,21,7,-14,18,-6,-19,-6,20,-6,-4,2,448,-100,745,98,-69,0,80,-1,41,1,-1,-20,-4,-1,-8,7,1,-163,-17,773,56,-50,-17,23,3,-15,0,2,-7,-1,-8,-5,13,1,-867,-30,549,4,-45,12,1,-6,25,4,4,-16,0,-12,-2,6,1,-919,-18,404,-9,-40,-10,-23,-2,-38,3,0,-12,3,3,-5,-1,0,-145,-13,159,-99,37,-49,-29,-10,-42,8,1,-8,1,-0,-3,-1,0,-88,-33,-23,-114,21,-78,30,-13,-47,11,-0,0,-0,-11,-2,-4,0,-177,-23,-24,-2,19,14,74,-3,36,1,-2,5,-2,0,-4,-13,1,-346,-45,24,-37,16,3,40,8,9,-0,-2,-7,-4,15,4,-11,2,-1368,-70,98,-83,21,-35,30,15,-34,-6,-1,-4,-1,4,7,2,2,-1491,-17,319,-29,-17,-52,133,-8,7,-7,1,11,1,-15,2,-13,3,-343,65,446,-29,10,-27,97,-35,28,0,-6,-14,6,-18,0,-32,3,1246,251,489,-48,-5,-22,48,-52,-0,-2,-3,-12,-1,-20,-5,-23,2,1834,392,425,-40,81,108,-13,-69,178,-26,2,8,-8,-45,-4,-24,4,-632,226,414,-10,-83,54,-166,-37,-11,-11,4,-1,-9,-19,-3,10,4,-2538,-164,274,70,-142,4,-111,27,-74,-1,-2,-19,-11,31,-7,6,2,-2000,-520,387,80,-111,-47,-38,13,-26,13,-4,-27,-8,19,-15,3,2,-157,-430,700,39,-141,-54,14,1,-67,11,-0,-36,-6,13,-8,-10,1,-803,-214,663,39,-131,-63,66,12,-70,8,4,-18,-1,21,-3,3,1,-1317,-97,376,-35,-71,-41,66,-4,-17,11,5,-17,-0,16,2,0,1,-1389,-49,247,8,-115,-98,85,0,-106,9,1,-8,2,-5,-4,-4,1,-257,43,110,-13,-77,-52,7,1,-72,5,0,-3,0,-2,-2,-1,0,30,-1,-0,-100,71,-67,-2,-10,-43,6,-0,5,-2,-5,-4,1,0,-378,-28,-24,-98,12,-57,13,-17,-34,7,-5,5,-3,5,-4,-9,1,-385,-10,21,29,10,48,38,5,61,-1,3,-4,-4,39,3,-6,2,-808,32,153,-170,20,-70,64,-9,35,6,-1,-18,-2,30,10,-19,2,-913,67,277,-167,186,7,-60,-43,138,0,-7,-0,-1,6,6,-21,2,-139,142,434,-26,70,-73,9,-46,26,8,-6,5,6,-5,-6,-13,3,1114,295,515,18,41,-9,109,-42,19,-1,-0,1,-2,-0,-8,-35,2,561,252,491,-65,183,95,40,-51,154,-22,1,13,-7,-25,-1,-19,4,-2205,-22,501,47,18,126,-18,-20,37,-19,0,7,-8,-13,-3,-0,3,-3979,-391,434,30,-81,-9,-13,5,-48,-2,-7,3,-8,25,-8,-10,2,-3115,-739,487,81,-46,-12,12,13,-15,1,-4,-2,-4,39,-7,-18,3,-617,-666,595,79,-138,-30,96,12,-26,7,2,-15,-0,3,-3,-13,1,-305,-316,460,91,-130,-39,108,36,-43,9,8,-16,-2,13,1,-17,1,-667,-72,354,155,-147,-11,103,34,-22,7,5,-11,-1,15,1,-14,0,-569,19,267,95,-139,-49,80,8,-61,7,0,-7,0,-4,-1,-12,0,85,85,108,-29,-97,-83,49,-3,-91,8,-0,-1,1,2,-0,-5,0,64,36,18,-132,57,-45,-26,-21,4,7,-0,3,-2,1,-2,0,1,-395,-4,15,9,-39,4,10,-12,27,-0,-0,1,0,10,-4,-5,2,19,66,92,-49,87,24,-99,-8,61,0,1,-4,-1,35,4,-11,2,-304,127,207,48,-19,29,36,10,93,-4,-0,-24,0,18,13,-31,2,6,181,262,51,78,21,-94,0,110,-16,-4,-5,3,7,8,-19,1,651,217,426,13,150,25,20,-19,47,-14,-1,1,3,19,-3,1,1,188,212,481,-22,72,4,5,-8,16,-22,-2,5,4,11,-2,-10,0,-1085,57,620,8,49,28,28,-10,40,-20,-2,1,-6,13,-0,-13,4,-3935,-223,786,-15,125,98,0,-7,20,-15,-3,7,-12,35,-3,-7,3,-5129,-497,699,4,74,34,-39,25,39,-12,-7,13,-11,42,-6,-23,3,-3417,-796,654,26,-2,-15,-52,34,-31,-7,-5,7,-5,23,-4,-5,3,-554,-692,651,-16,26,15,42,26,33,-0,1,2,-3,-0,2,-6,1,-25,-352,380,63,-53,-13,35,35,-11,2,4,-3,-1,-0,4,-23,1,191,-0,364,-28,20,-48,24,25,-43,6,2,-4,-0,8,2,-9,1,299,114,276,-6,-43,-79,37,7,-67,3,-0,-10,-1,-17,-2,-7,1,375,130,192,-22,-12,-28,39,-4,-21,-0,0,0,4,-1,-0,-2,0,151,80,81,-64,30,-23,-27,-8,10,1,0,3,2,2,-0,2,1,49,80,99,3,30,20,-44,-5,55,-8,0,2,8,-18,-2,-3,1,629,197,214,53,-29,37,26,1,68,-22,-2,-0,5,-9,4,-9,-1,917,259,216,3,-15,-0,116,12,51,-30,-2,-21,8,-16,10,-10,-3,1014,273,124,-32,4,-26,80,-4,4,-38,-4,-24,12,-6,6,-11,-3,783,199,207,-2,-3,-7,39,11,-52,-45,-4,-16,10,8,-1,7,-3,-497,-42,254,66,-67,-1,143,28,11,-50,-1,-4,4,2,-0,8,-4,-2648,-261,428,-10,85,81,8,18,27,-61,0,9,-6,12,1,12,-2,-4725,-373,528,-28,78,74,-28,20,-25,-61,0,20,-9,22,-2,20,-2,-4552,-516,515,31,-102,34,2,57,-18,-53,-3,8,-7,41,-2,19,-3,-2367,-728,546,-28,-58,-21,30,60,-23,-34,1,-0,-6,23,2,0,-1,125,-578,531,39,43,94,-36,36,91,-40,3,11,0,-11,2,-19,-1,1002,-193,450,-66,25,-21,-35,19,-14,-17,-1,-3,7,-12,0,-8,-1,1439,173,301,16,-31,48,-0,13,53,-20,-1,0,4,1,1,6,-3,1253,265,182,-4,-36,49,-8,-3,82,-19,-2,-1,1,-16,1,2,-2,888,209,129,-5,-9,-2,17,0,4,-14,-0,-2,5,-17,0,3,-1,316,112,99,48,-28,-12,20,0,13,-2,0,-5,5,-9,0,5,-0,516,137,169,3,-63,-49,17,-6,14,-12,0,-7,11,-15,4,2,-3,876,258,246,1,-35,-36,73,19,-4,-28,-2,1,13,-22,3,-4,-4,1458,355,212,11,-49,-64,125,27,-35,-29,-0,4,12,-24,1,11,-4,1571,297,106,-4,-16,-12,45,5,-47,-37,-1,-4,9,-13,0,-10,-2,512,85,122,-10,49,60,-5,12,1,-40,-1,-9,5,4,0,12,-2,-1152,-244,48,36,-3,55,108,27,76,-48,1,-3,-1,18,0,8,-2,-3371,-482,223,-76,74,25,-0,9,18,-55,2,4,-4,30,-2,-9,-0,-4345,-536,355,-92,171,99,-147,8,74,-61,1,1,-1,1,-4,-1,-1,-3803,-601,374,15,-17,43,-37,62,64,-60,-2,-4,1,2,-6,7,-1,-1985,-733,507,22,48,28,-6,74,87,-49,2,-2,-0,-18,-3,-11,-2,658,-452,660,11,-2,41,8,28,65,-40,3,-1,9,-24,1,0,-4,1618,56,617,30,-8,40,-17,26,38,-29,-1,-12,14,-39,-1,8,-3,2216,338,533,82,6,76,13,28,84,-23,-2,-5,6,-25,-0,16,-2,1854,435,439,41,63,102,3,-12,156,-9,-0,-7,2,-2,1,4,-0,966,310,305,-14,91,36,-69,-6,40,-5,-1,0,1,-8,3,4,0,447,125,155,44,-9,-10,-12,-14,8,2,-1,-3,2,-22,1,2,0,397,108,155,137,-44,-2,71,0,58,-0,1,-7,6,-13,4,-7,0,790,271,423,-19,36,-48,46,12,66,0,3,-0,10,-6,0,-12,0,1127,433,558,86,-40,-64,89,50,-7,-6,1,10,7,-3,-2,-13,-0,1285,314,420,62,5,-22,44,32,29,5,0,11,5,-13,-3,-18,0,455,39,177,-1,5,-60,53,39,-7,1,1,2,-0,-14,-1,-3,-0,-885,-296,-60,-4,62,2,-14,37,66,-19,2,-12,-4,7,-2,-17,0,-2507,-429,221,0,82,53,-24,2,54,-33,4,-7,-3,29,-1,-25,2,-3311,-467,394,-76,102,45,-133,3,36,-30,0,-4,-1,6,-5,-7,2,-2812,-612,496,-7,53,33,26,45,91,-24,-2,-15,-0,3,-8,-2,1,-1514,-765,616,-27,21,-58,-57,47,33,-11,-3,-15,1,-20,-8,-28,0,848,-383,567,74,-88,-30,63,27,0,-14,-0,-12,8,-14,-6,-3,0,1706,133,667,-60,57,-54,-21,10,-14,-1,2,-18,8,-29,-4,-0,1,2215,483,886,-14,41,-25,-16,9,9,-5,1,-12,4,-40,-1,11,0,1510,538,733,-72,96,-6,12,-18,55,-1,-3,-7,2,-12,4,5,0,617,363,466,-37,60,9,-68,-10,15,-5,-1,1,-1,-1,2,2,0,95,72,159,-0,21,-8,-25,-10,7,-1,-1,-1,1,0,2,-4,0,-110,5,132,32,75,3,1,2,42,-10,-0,6,4,-17,1,-4,1,408,220,415,-118,118,-61,19,-7,95,12,0,0,9,-33,1,-3,0,845,493,649,-30,-4,-80,51,27,37,14,-3,6,3,-2,3,-21,-0,1040,403,543,-29,-15,-88,84,30,49,26,-5,9,-3,-1,5,-28,-0,738,134,201,136,-92,53,71,46,84,9,-5,3,-10,-3,-0,-10,1,114,-97,53,20,-30,1,73,21,59,-3,-4,-3,-12,13,1,-18,2,-1126,-197,260,-60,129,53,-72,-7,73,-13,-2,9,-11,-3,3,-11,4,-2163,-334,442,-70,81,41,-109,2,64,-10,-3,-11,-10,-1,-5,-25,4,-2825,-687,579,-66,69,-12,2,18,54,3,-8,-21,-8,-9,-13,-28,4,-1159,-737,515,-45,83,-35,15,13,45,8,-8,-11,-5,-18,-11,-15,2,1475,-298,361,19,18,-13,24,17,27,-6,-4,-16,4,-12,-4,17,1,2345,200,457,-18,75,36,-57,6,89,-9,3,3,6,-23,-0,7,0,2661,625,830,-4,96,63,-103,4,50,-12,3,5,3,-33,-0,25,0,1841,645,867,-9,68,33,-7,-12,68,-3,-3,3,0,-3,4,16,-0,629,355,479,59,-17,26,41,-0,37,-4,-1,-4,-2,2,1,4,-0,22,43,141,17,24,19,1,11,29,-10,-2,-9,2,22,1,-7,0,-379,-49,183,114,-56,4,46,13,-11,-12,-3,-3,3,-4,-0,-4,0,-12,101,372,88,3,23,95,18,65,-5,-3,12,6,-43,-0,-12,0,728,411,478,7,34,-15,50,30,86,5,-2,16,1,-22,4,-8,-0,1512,515,506,-1,44,-37,84,25,86,14,-3,22,-0,-16,5,-12,0,1634,378,355,-43,9,-78,94,13,13,19,-4,10,-5,9,0,-16,0,1323,123,285,75,-15,25,-24,13,37,-4,-2,6,-7,1,-2,3,1,375,-19,418,34,18,45,-102,-2,35,-10,-1,0,-6,-5,-1,-20,4,-1404,-314,466,58,-73,11,-36,2,13,0,-2,-24,-4,16,-5,-31,3,-3083,-772,576,32,19,18,-34,4,91,3,-9,-18,-5,-26,-12,11,3,-422,-700,213,-10,119,11,-13,-7,-28,0,-9,8,-5,-26,-9,29,2,2814,-115,-38,12,75,22,-17,-14,43,-3,-6,12,2,-12,-1,38,2,3388,420,256,53,-18,54,-54,-4,62,-12,3,20,2,4,1,16,0,3315,759,755,-30,29,33,-22,-22,27,-5,2,4,1,-31,0,11,0,1973,672,758,34,-11,32,-22,-8,24,-5,-2,-1,-1,-5,1,9,-0,623,319,461,-13,30,6,11,-4,22,-0,-1,-0,-0,4,1,0,-0,-6,65,175,-18,67,37,-30,7,42,-8,-1,-4,4,-4,1,-5,0,-260,-32,131,6,24,7,37,12,-6,-9,-5,7,1,3,-0,-8,0,-219,32,263,117,-49,39,109,18,31,-10,-3,18,-0,-38,1,-5,0,319,260,395,89,-46,-8,10,29,-10,-2,1,19,-3,5,6,7,0,1345,560,470,23,-35,-114,56,16,-32,19,-4,33,-0,-15,6,6,0,2488,667,577,-1,6,-97,55,-7,4,16,-1,20,-1,-30,-2,4,0,2622,452,525,23,23,-51,1,-0,-4,5,0,14,-1,-4,-3,6,2,1196,99,604,80,16,90,-88,-23,-1,-6,1,5,-4,1,-2,0,3,-608,-174,636,0,3,11,-66,-13,-41,0,1,-10,-3,-2,-4,2,3,-1763,-523,649,23,-41,-64,23,-1,-38,12,-8,0,-1,-17,-3,27,2,1239,-364,297,-81,14,-29,-86,-27,-112,16,-13,17,-4,-14,-2,38,1,3821,169,108,-16,-52,-9,-68,-23,-35,-2,-9,11,0,6,0,14,1,3486,614,461,12,-17,29,35,-13,68,-7,-1,17,0,4,-0,23,0,2902,781,833,-3,11,33,-13,-14,26,-8,-0,7,0,-24,-0,22,-0,1547,606,735,-34,59,24,-70,-16,12,-2,-3,5,-0,-22,-0,4,-0,526,264,390,-79,70,-8,-37,-10,17,4,-2,0,0,-10,-0,0,-0,-3,54,156,42,2,41,-12,5,10,-8,-2,2,1,-7,-0,-3,0,-5,-12,28,74,-9,49,20,10,12,-10,-4,5,4,-1,-0,0,0,-139,-8,159,129,-29,83,38,29,29,-15,-3,17,-1,24,-0,4,0,-246,60,232,43,4,40,-36,33,-28,-7,1,16,-6,24,6,13,-0,1119,473,495,-9,24,-32,-53,10,-89,10,-3,25,-3,1,5,8,1,2395,783,719,48,58,30,-56,0,-18,10,-2,28,-3,-15,-1,13,1,2866,728,805,-82,18,-84,-108,-19,-45,12,2,24,-4,-0,-4,22,2,2056,430,935,12,-16,73,-108,-38,31,-3,6,17,-2,-5,-4,53,4,1020,212,1068,12,20,23,-82,-29,72,-7,3,11,-1,-15,-5,2,4,621,102,1091,85,-39,-24,-52,-7,-55,1,-5,21,-2,-3,-3,9,2,2527,297,921,-40,51,65,-134,-10,13,-1,-5,19,-0,-1,-0,27,2,3467,613,698,-106,11,5,-12,-11,24,-2,-4,16,0,0,-3,22,1,2789,709,823,-42,62,13,-71,-0,28,-8,0,22,1,-11,-5,36,0,2407,691,911,48,11,66,-59,1,14,-12,-2,14,-0,-6,-5,24,0,1251,427,639,-43,66,10,-1,0,21,-3,-3,9,0,-19,-1,2,-0,447,154,302,26,-16,6,-2,5,9,-1,-1,1,0,-8,-1,0,-0,58,10,85,65,-34,29,13,10,-8,-8,-1,2,0,-1,0,-0,0,-5,-14,-26,104,-37,65,-20,16,-0,-13,-2,5,0,1,0,4,0,-49,-26,29,112,-28,78,4,22,-8,-14,-3,10,0,30,1,15,0,-132,-8,134,72,27,101,-42,20,-15,-16,-3,10,-3,29,5,24,0,35,165,265,-0,67,23,-116,14,-84,-11,-7,17,-7,25,5,27,0,1029,583,673,55,-21,-31,8,6,-141,0,-3,20,-2,5,-0,14,2,1979,786,1009,63,-54,-47,85,-9,-76,10,5,24,-2,4,1,12,2,2200,727,1214,-114,3,-122,24,-38,-75,7,2,18,2,-16,0,57,5,1359,570,1345,-48,61,-32,-3,-24,42,-5,1,17,2,-22,-1,8,5,1122,525,1486,-41,90,-0,-22,-14,19,-4,-2,19,0,-24,0,1,3,2439,677,1300,-82,15,-13,5,2,-46,-3,-9,17,1,-8,0,20,2,2534,665,970,-39,56,51,-80,9,72,-7,-3,9,1,-13,-5,27,1,2188,567,844,24,67,58,-117,12,37,-15,0,14,1,0,-9,29,1,1782,457,705,49,12,50,-42,10,36,-8,-2,15,-0,-1,-3,17,0,1001,245,422,65,-24,21,14,10,24,-5,-4,6,-0,-16,-1,1,-0,371,66,158,51,-26,15,6,6,8,-3,-2,1,-0,-4,-0,-1,-0,118,5,22,11,-6,5,3,2,-2,-1,-0,0,0,-1,-0,0,0,10,-2,-7,12,5,19,-5,3,0,-2,-1,0,-0,-7,-0,3,0,3,-15,-11,-32,68,35,-39,2,13,-3,-2,6,-1,-1,1,11,0,79,-2,22,68,8,73,-30,12,-11,-9,-3,11,-0,12,1,17,0,80,12,101,19,49,49,-49,11,-53,-8,-4,17,-4,16,4,32,0,66,109,231,-9,122,63,-89,-3,3,-12,0,16,-4,5,1,35,1,623,356,508,28,-11,-31,-41,-11,-22,2,5,19,-1,-10,-2,-9,0,1196,519,821,-15,12,-45,-45,-23,-15,6,-2,9,2,-14,-5,-9,3,850,453,1075,-49,-12,-71,-46,-12,-2,6,2,13,2,-8,-3,2,4,907,369,1064,-35,-10,-26,-27,-2,-43,2,-2,2,0,-6,0,18,2,1328,357,883,25,-14,56,25,5,34,-3,-2,-0,0,-21,-2,24,1,1362,330,610,-23,102,73,-88,6,98,-3,-0,6,0,-26,-4,27,0,1253,260,424,142,2,97,-36,27,70,-16,-0,19,0,-22,-6,20,0,1141,152,260,104,-17,74,11,14,59,-10,-0,8,0,-16,-2,3,0,587,69,121,25,-9,14,14,1,17,-1,-0,1,0,-10,-0,0,-0,203,30,39,14,-1,12,1,0,10,-0,-0,0,0,-0,-0,0,-0,32,3,2,53,22,70,-108,13,23,-39,-3,-16,-1,-25,-5,3,0,-144,-60,788};
 
#endif

int tanh_INT(long val){
  int scale = 1000;
  if(val >= scale) 
    return scale;
  if(val <= -scale)
    return -scale; 
  return val - (0.001*val)*(0.001*val)*val*0.33;
}

void computeZ_X(double *Z_X, int test, int ind, int numVec){
  int count=0;
  for(int zp=ind*numVec ; zp < (ind+1)*numVec ; zp++){
    int zval;
    #if FLASH
      zval = pgm_read_word_near(&(model[zp]));
    #else
      zval = model[zp];
    #endif
    Z_X[count] += test * double(zval);
    count++;
  }
}

void setup() {
  // put your setup code here, to run once:
  pinMode(8, OUTPUT);
  Serial.begin(9600);
  
  Serial.print(F("Initializing SD card..."));
  if (!SD.begin(4)) {
    Serial.println(F("initialization failed!"));
    return;
  }
  Serial.println(F("initialization done."));
}

void loop() {
  // put your main code here, to run repeatedly:
  if(Serial.available()==0){

    unsigned long count = 0;
    unsigned int repeat = 1;
    unsigned long time1,time2=0;
    unsigned long Correct=0; 
    int dim,numLeaf;
    #if FLASH
      dim=pgm_read_word_near(&D);
      numLeaf=pgm_read_word_near(&M);
    #else
      dim=D;
      numLeaf=M;
    #endif
    
    for(unsigned int itr=0;itr<repeat;itr++){

      String str="";
      bool labelFlag=1;
      int ind=0,testY;
      int numVec = 2*(2*numLeaf-1) + numLeaf-1;

      double *Z_X = new double[numVec];
      for(int p=0;p<numVec;p++)
        Z_X[p] = 0.0; 
        
      // Open the test data file for prediction
      File myFile = SD.open(datasetName);
      /*if (myFile)
        Serial.println(F("Opening Test data file:"));
      else 
        Serial.println(F("Error opening Test file"));
      */
      // read from the file until there's nothing else in it:
      while (myFile.available()){
        char c = myFile.read();
        if(c != '/' && c != ',')  
          str += c;
        else if(c == '/' || c == ','){
          if(labelFlag==1){
            testY = str.toInt();
            labelFlag=0;
          }else{ 
            int testX = 10*str.toFloat();
            //time1 = micros();
            if(testX != 0)
              computeZ_X(Z_X, testX, ind, numVec);
            //time2 += micros() - time1;
            ind++;
          }
          str="";
          
          if(c == '/'){
            count++;
            ind=0; labelFlag=1;

            // Start Time
            time1 = micros();
            int curr = 0;
            double Score = 0.0;
            while(curr < numLeaf-1){
              Score += tanh_INT(Z_X[curr+2*numLeaf-1]) * Z_X[curr];
              long tt = Z_X[curr+2*(2*numLeaf-1)];
              curr = (tt>0) ? 2*curr+1 : 2*curr+2;
            }
            Score += tanh_INT(Z_X[curr+2*numLeaf-1]) * Z_X[curr];
            if(testY*Score>0)
              Correct++;

            // End Time
            time2 += micros() - time1; 
            
            for(int p=0;p<numVec;p++)
              Z_X[p] = 0; 
          }
        }
      }
      delete [] Z_X;
      myFile.close();
    }
    Serial.println(F("Accuracy : "));
    Serial.println(Correct*100/count);
    Serial.println(F("Time  : "));
    Serial.println((float)time2/count+dim*4);
  }
}
